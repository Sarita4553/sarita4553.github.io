<!DOCTYPE html>
<html>
<head>
  <title>OneSignal Register</title>
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
  <script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
      OneSignal.init({
        appId: "d2783680-973f-459a8550-686b0f9c77b4",
      });

      OneSignal.on("subscriptionChange", function(isSubscribed) {
        if (isSubscribed) {
          OneSignal.getUserId().then(function(playerId) {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get("userId");

            if (userId && playerId) {
              fetch("https://script.google.com/macros/s/AKfycbySkTTqF-tyPWtv3qrWWxxp1VrD4W2MyVPU1C1LCBI_MRn8sCtjtbvCD1igQ3ykIs86ag/exec", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId, playerId })
              }).then(() => {
                document.body.innerHTML = "<h2>Device Registered</h2>";
              }).catch(() => {
                document.body.innerHTML = "<h2>Error registering device</h2>";
              });
            } else {
              document.body.innerHTML = "<h2>Error: Missing userId or playerId</h2>";
            }
          });
        } else {
          document.body.innerHTML = "<h2>Please enable notifications</h2>";
        }
      });
    });
  </script>
</head>
<body>
  <h2>Enabling Notifications...</h2>
</body>
</html>
